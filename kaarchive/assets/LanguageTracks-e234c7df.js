import{_ as P,r as v,G as U,H as z,o as l,c as r,d as I,a as t,b as w,F as x,I as $,E as B,t as E,w as j,D as q,e as D,f as N,p as F,g as G}from"./index-bdd4fce9.js";import{M as H}from"./bootstrap.esm-3ed82201.js";import{_ as O}from"./SiteHeader-28c32133.js";const Q=""+new URL("firstencounter/languagetracks/firstencounter-noaudio-poster.webp",import.meta.url).href,X=""+new URL("firstencounter/languagetracks/firstencounter-noaudio.mp4",import.meta.url).href;const f=b=>(F("data-v-a69795b7"),b=b(),G(),b),J={class:"d-flex flex-row justify-content-center align-items-center flex-wrap mb-1",style:{"margin-right":"-0.25rem !important","margin-left":"-0.25rem !important"}},K=["onClick"],W=["src"],Y={class:"video-container"},Z={class:"language-name-container"},ee={key:0,class:"video-container-overlay"},te=f(()=>t("div",{class:"fs-4 mt-5"},"Select a language.",-1)),se=[te],ae={key:1,class:"video-container-overlay"},ne={class:"fs-4 my-5"},oe=f(()=>t("div",{class:"spinner-border"},null,-1)),ie={class:"mt-2 d-flex flex-row justify-content-center"},le=["href","download"],re=f(()=>t("i",{class:"bi bi-download"},null,-1)),ce=[re],de={class:"card p-2 mb-2 d-flex flex-row"},ue=f(()=>t("span",{class:"me-1 icon-vol"},[t("i",{class:"bi bi-volume-off-fill"})],-1)),ve=f(()=>t("span",{class:"ms-1 icon-vol"},[t("i",{class:"bi bi-volume-up-fill"})],-1)),pe=N('<div class="text-center" style="font-size:0.8rem;" data-v-a69795b7><div class="alert alert-success d-inline-flex mt-2 p-2" data-v-a69795b7><div class="me-2" data-v-a69795b7><i class="bi bi-exclamation-circle-fill" data-v-a69795b7></i></div><div class="flex-grow-1 text-start" data-v-a69795b7>The audio can be slightly offset depending on the device you are using. May not work properly on iOS. </div></div></div>',1),fe={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable",style:{}},me={class:"modal-content"},_e=f(()=>t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5"},"Select Languages"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),he={class:"modal-body p-0"},be=["onClick"],ye={class:"flag-container me-2"},ge=["src"],Le={class:"modal-footer"},ke={__name:"LanguageTracks",setup(b){const L=v(null),T=v(null);let y=null;const n=v(null),g=v(50),c=v(-1);let m=!1,i=null;const d=new Map,_=new Map,u=v(["english","german","japanese","swedish","french","portuguese","spanish","dutch","arabic_egyptian","bulgarian","croatian","danish","korean","finnish","norwegian","hungarian","icelandic","italian","chinese","russian","slovak","chinese_taiwan","tamil","telugu","ukrainian","arabic_qatar","portuguese_brazil"].sort()),h=v([]),k=e=>e?e==="arabic_egyptian"?"Arabic (Egypt)":e==="arabic_qatar"?"Arabic (Qatar)":e==="chinese"?"Chinese (Standard Mandarin)":e==="chinese_taiwan"?"Chinese (Taiwanese Mandarin)":e==="portuguese"?"Portuguese (Portugal)":e==="portuguese_brazil"?"Portuguese (Brazil)":`${e[0].toUpperCase()}${e.slice(1)}`:"",R=()=>{u.value.length<=0||y.show()},S=e=>{h.value.push(e),h.value.sort(),u.value=u.value.filter(a=>a!==e),n.value||C(e)},V=()=>{h.value.push(...u.value),h.value.sort(),u.value=[],y.hide()},C=e=>{if(n.value===e)return;const a=m,s=L.value;if(s.pause(),i&&i.pause(),d.has(e)){const o=d.get(e);o.addEventListener("canplay",()=>{o.addEventListener("canplaythrough",()=>{n.value===e&&(a&&(s.play(),o.play()),c.value=1)},{once:!0}),d.set(e,o),n.value===e&&(c.value=1),o.currentTime=s.currentTime},{once:!0}),o.load()}else if(!_.has(e)){c.value=0;const o=new XMLHttpRequest;o.open("GET",`./assets/firstencounter/languagetracks/languages/${e}.m4a`,!0),o.responseType="blob",o.onload=({target:M})=>{if(M.status==200){const p=new Audio(URL.createObjectURL(M.response));p.addEventListener("canplay",()=>{p.addEventListener("canplaythrough",()=>{n.value===e&&(a&&(s.play(),p.play()),c.value=1)},{once:!0}),d.set(e,p),_.delete(e),n.value===e&&(c.value=1),p.currentTime=s.currentTime},{once:!0}),p.load()}},o.send(),_.set(e,o)}n.value=e},A=()=>{i&&(i.volume=g.value/100)};return U(()=>{const e=L.value;e.addEventListener("canplaythrough",()=>{e.controls=!0}),e.addEventListener("play",()=>{const a=d.get(n.value);a.volume=g.value/100,a.paused&&a.play(),i=a,m=!0}),e.addEventListener("pause",()=>{i&&i.pause(),m=!1}),e.addEventListener("ended",()=>{m=!1}),e.addEventListener("timeupdate",()=>{if(!i||Math.abs(e.currentTime-i.currentTime)<=.5)return;const a=m,s=n.value;e.pause(),i.pause(),i.addEventListener("canplaythrough",()=>{n.value===s&&a&&(e.play(),i.play())},{once:!0}),i.currentTime=e.currentTime}),e.load(),y=new H(T.value)}),z(()=>{_.forEach(e=>{e.abort()}),_.clear(),d.forEach(e=>{e.src=""}),d.clear()}),(e,a)=>(l(),r(x,null,[I(O,{category:"First Encounter",title:"Language Tracks"}),t("div",J,[u.value.length>0?(l(),r("button",{key:0,type:"button",class:"btn btn-success ms-1 me-2 my-2",onClick:R},"Select Languages")):w("",!0),(l(!0),r(x,null,$(h.value,s=>(l(),r("div",{class:B(["flag-container flag-container-page mx-1 my-1",{"flag-container-page-active":n.value===s}]),key:s,onClick:o=>C(s)},[t("img",{class:"flag",src:`./assets/flags/${s}.svg`},null,8,W)],10,K))),128))]),t("div",Y,[t("video",{ref_key:"videoRef",ref:L,class:"d-block z-0",muted:"",disableRemotePlayback:"",poster:Q,preload:"auto",src:X},null,512),t("div",Z,E(k(n.value)),1),c.value===-1?(l(),r("div",ee,se)):w("",!0),c.value===0?(l(),r("div",ae,[t("div",ne,"Loading "+E(k(n.value))+"...",1),oe])):w("",!0)]),t("div",ie,[t("a",{class:"card p-2 me-2 mb-2 dl-btn",href:`./assets/firstencounter/languagetracks/languages/${n.value}.m4a`,role:"button",download:`firstencounter-${n.value}`},ce,8,le),t("div",de,[ue,j(t("input",{type:"range",class:"form-range",min:"0",max:"100",step:"1","onUpdate:modelValue":a[0]||(a[0]=s=>g.value=s),onInput:A,style:{width:"200px"}},null,544),[[q,g.value]]),ve])]),pe,t("div",{ref_key:"modalRef",ref:T,class:"modal fade"},[t("div",fe,[t("div",me,[_e,t("div",he,[(l(!0),r(x,null,$(u.value,s=>(l(),r("div",{key:s,class:"d-flex align-items-center border-bottom px-2 py-1 modal-language-container",onClick:o=>S(s)},[t("div",ye,[t("img",{class:"flag",src:`./assets/flags/${s}.svg`,style:{"border-radius":"3px"}},null,8,ge)]),t("div",null,E(k(s)),1)],8,be))),128))]),t("div",Le,[t("button",{type:"button",class:"btn btn-secondary",onClick:a[1]||(a[1]=s=>D(y).hide())},"Close"),t("button",{type:"button",class:"btn btn-success",onClick:V},"All")])])])],512)],64))}},Te=P(ke,[["__scopeId","data-v-a69795b7"]]);export{Te as default};
